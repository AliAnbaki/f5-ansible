---

- import_tasks: setup.yaml

- name: Get a license
  set_fact:
    license_key: "{{ lookup('license_hopper', filename='/here/tmp/licenses/bigiq-regkey-licenses.txt', remove=True) }}"

- name: Add a license to the license pool
  bigiq_regkey_license:
    regkey_pool: regkey-pool-1
    license_key: "{{ license_key }}"
    accept_eula: yes
    description: my license
  register: result

- name: Assert Add a license to the license pool
  assert:
    that:
      - result is changed

- name: Add a license to the license pool - Idempotent check
  bigiq_regkey_license:
    regkey_pool: regkey-pool-1
    license_key: "{{ license_key }}"
    accept_eula: yes
    description: my license
  register: result

- name: Assert Add a license to the license pool - Idempotent check
  assert:
    that:
      - result is not changed

- name: Remove a license to the license pool
  bigiq_regkey_license:
    regkey_pool: regkey-pool-1
    license_key: "{{ license_key }}"
    state: absent
  register: result

- name: Assert Remove a license to the license pool
  assert:
    that:
      - result is changed

- name: Remove a license to the license pool - Idempotent check
  bigiq_regkey_license:
    regkey_pool: regkey-pool-1
    license_key: "{{ license_key }}"
    state: absent
  register: result

- name: Assert Remove a license to the license pool - Idempotent check
  assert:
    that:
      - result is not changed

- import_tasks: teardown.yaml
