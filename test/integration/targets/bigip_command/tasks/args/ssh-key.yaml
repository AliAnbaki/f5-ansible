---

- name: Args - Run single command - cli
  bigip_command:
    commands:
      - tmsh show sys version
    transport: cli
    user: "{{ bigip_ssh_username }}"
    server: "{{ ansible_host }}"
    server_port: "{{ bigip_ssh_port }}"
    ssh_keyfile: "{{ bigip_ssh_keyfile|default(omit) }}"
  register: result

- name: Args - Assert Run single command - cli
  assert:
    that:
      - result.stdout_lines|length == 1

- name: Args - Run multiple commands - cli
  bigip_command:
    commands:
      - tmsh show sys clock
      - tmsh list auth
    transport: cli
    user: "{{ bigip_ssh_username }}"
    server: "{{ ansible_host }}"
    server_port: "{{ bigip_ssh_port }}"
    ssh_keyfile: "{{ bigip_ssh_keyfile }}"
  register: result

- name: Args - Assert Run multiple commands - cli
  assert:
    that:
      - result.stdout_lines|length == 2

- name: Args - Run command missing tmsh - cli
  bigip_command:
    commands:
      - show sys clock
    transport: cli
    user: "{{ bigip_ssh_username }}"
    server: "{{ ansible_host }}"
    server_port: "{{ bigip_ssh_port }}"
    ssh_keyfile: "{{ bigip_ssh_keyfile }}"
  register: result

- name: Args - Assert Run command missing tmsh - cli
  assert:
    that:
      - result.stdout_lines|length == 1

- name: Args - Run multiple commands, one missing tmsh - cli
  bigip_command:
    commands:
      - tmsh show sys clock
      - list auth
    transport: cli
    user: "{{ bigip_ssh_username }}"
    server: "{{ ansible_host }}"
    server_port: "{{ bigip_ssh_port }}"
    ssh_keyfile: "{{ bigip_ssh_keyfile }}"
  register: result

- name: Args - Assert Run multiple commands, one missing tmsh - cli
  assert:
    that:
      - result.stdout_lines|length == 2

- name: Args - Wait for something - cli
  bigip_command:
    commands:
      - tmsh show sys clock
    wait_for:
      - result[0] contains Sys::Clock
    transport: cli
    user: "{{ bigip_ssh_username }}"
    server: "{{ ansible_host }}"
    server_port: "{{ bigip_ssh_port }}"
    ssh_keyfile: "{{ bigip_ssh_keyfile }}"
  register: result

- name: Args - Assert Wait for something - cli
  assert:
    that:
      - result.stdout_lines|length == 1
      - "'Sys::Clock' in result.stdout[0]"

- name: Args - Run modify commands - cli
  bigip_command:
    commands:
      - tmsh modify sys db setup.run value true
      - tmsh modify sys db setup.run value false
    transport: cli
    user: "{{ bigip_ssh_username }}"
    server: "{{ ansible_host }}"
    server_port: "{{ bigip_ssh_port }}"
    ssh_keyfile: "{{ bigip_ssh_keyfile }}"
  register: result

- name: Args - Assert Run modify commands - cli
  assert:
    that:
      - result.stdout_lines|length == 2

- name: Args - Run modify commands with a show command - cli
  bigip_command:
    commands:
      - tmsh modify sys db setup.run value true
      - tmsh modify sys db setup.run value false
      - tmsh show sys clock
    transport: cli
    user: "{{ bigip_ssh_username }}"
    server: "{{ ansible_host }}"
    server_port: "{{ bigip_ssh_port }}"
    ssh_keyfile: "{{ bigip_ssh_keyfile }}"
  register: result

- name: Args - Assert Run modify commands with a show command - cli
  assert:
    that:
      - result.stdout_lines|length == 3
